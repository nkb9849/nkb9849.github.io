---
layout : single
title : 정보보안 SUA-[오픈소스 보안]6주차 npcap 예제 파일 "iflist.c" 분석
---


# 1. 과제

[필수1]1주일에 한번씩 공부하고 있는 오픈소스에 대한 내용을 블로그에 정리한다.

# 2. 내용

npcap 예제 라이브러리 중 "iflist.c"라는 파일을 분석하기 시작했다. 소스코드에 대한 전체적인 분석보다는 pcap_API() 및 중요한 부분을 위주로 분석을 진행했다. 

- iflist.c : 시스템의 디바이스 이름, 네트워크 IP, 패킷 등을 탐지하는 소스코드이다.

```
 if (pcap_findalldevs_ex(source, NULL, &alldevs, errbuf) == -1)
  {
    fprintf(stderr,"Error in pcap_findalldevs: %s\n",errbuf);
    exit(1);
  }
```
pcap_findalldevs_ex() 함수는 pcap_open()으로 열 수 있는 네트워크 장치 목록을 만드는 함수로, pcap_findalldevs() 함수의 상위 집합으로 볼 수 있다. 
두 함수의 차이점으로는 pcap_findalldevs() 힘수는 로컬 시스템에 있는 디바이스만 목록을 만들 수 있으며, pcap_findalldevs_ex()를 사용하면 원격 시스템에 있는 장치도 목록을 만들 수 있다. 
pcap_findalldevs_ex() 함수의 구조체는 다음과 같다.
pcap_findalldevs_ex()의 구조는 pcap_findalldevs_ex(char *, struct pcap_rmtauth *, pcap_if_t **, char *)이다. 
원격. 로컬 시스템에 있는 디바이스 목록에 이상이 없다면, 즉, 모든 것이 정상이면 '0'을 일부 오류가 발생하면 '-1'이 반환되며, 장치 목록은 'alldevs' 이라는 매개변수에 반환된다. 
이 함수는 시스템에 나열할 인터페이스가 없는 경우에도 '-1'을 반환한다. 오류 메시지는 'errbuf' 변수에 반환된다.

```
  for(d=alldevs;d;d=d->next)
  {
    ifprint(d);
  }

  pcap_freealldevs(alldevs);

  return 1;
}
```
pcap_freealldevs() 함수는 장치 목록을 해제하는 함수이며, allldevs가 가리키는 장치 목록을 해제한다.

```
void ifprint(pcap_if_t *d)
{
  pcap_addr_t *a;
  char ip6str[128];
  /* Name */
  printf("%s\n",d->name);
  /* Description */
  if (d->description)
    printf("\tDescription: %s\n",d->description);
  /* Loopback Address*/
  printf("\tLoopback: %s\n",(d->flags & PCAP_IF_LOOPBACK)?"yes":"no");
  /* IP addresses */
  for(a=d->addresses;a;a=a->next) {
    printf("\tAddress Family: #%d\n",a->addr->sa_family);
   switch(a->addr->sa_family)
    {
      case AF_INET:
        printf("\tAddress Family Name: AF_INET\n");
        if (a->addr)
          printf("\tAddress: %s\n",iptos(((struct sockaddr_in *)a->addr)->sin_addr.s_addr));
        if (a->netmask)
          printf("\tNetmask: %s\n",iptos(((struct sockaddr_in *)a->netmask)->sin_addr.s_addr));
        if (a->broadaddr)
          printf("\tBroadcast Address: %s\n",iptos(((struct sockaddr_in *)a->broadaddr)->sin_addr.s_addr));
        if (a->dstaddr)
          printf("\tDestination Address: %s\n",iptos(((struct sockaddr_in *)a->dstaddr)->sin_addr.s_addr));
        break;
     case AF_INET6:
        printf("\tAddress Family Name: AF_INET6\n");
        if (a->addr)
          printf("\tAddress: %s\n", ip6tos(a->addr, ip6str, sizeof(ip6str)));
       break;
      default:
        printf("\tAddress Family Name: Unknown\n");
        break;
    }
  }
  printf("\n");
}
```
위의 소스코드는 설치된 장치에 대한 고급 정보를 얻는 코드이다. 
특히 pcap_findalldevs_ex() 가 pcap_if 반환하는 모든 구조 에는 다음과 같은 구조 목록도 포함되어 있습니다 .pcap_addr

해당 인터페이스의 주소 목록입니다.
넷마스크 목록(각각 주소 목록의 항목에 해당).
브로드캐스트 주소 목록(각각 주소 목록의 항목에 해당).
대상 주소 목록(각각 주소 목록의 항목에 해당).
또한 pcap_findalldevs_ex()지정된 로컬 폴더에 있는 원격 어댑터 및 pcap 파일 목록을 반환할 수도 있습니다.

다음 샘플은 pcap_if구조 의 전체 내용을 인쇄하는 ifprint() 함수를 제공합니다 . 에서 반환한 모든 항목에 대해 프로그램에서 호출합니다 pcap_findalldevs_ex().



